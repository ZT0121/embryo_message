<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <link rel="icon" type="image/png" href="favicon.png" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è½‰å…¥ï½œè¼¸å‡º å›å ±è¨Šæ¯ç”¢ç”Ÿå™¨</title>
  <style>
    /* å…¨åŸŸè¨­å®š - èˆ‡å…¶ä»–é é¢çµ±ä¸€ */
    :root {
      --bg: #fdfaf7;
      --text: #4b3b30;
      --text-light: #6d5648;
      --primary: #d8c3a5;
      --primary-hover: #cbb08e;
      --secondary: #f3d7c3;
      --border: #e0d6cd;
      --white: #ffffff;
      --success: #a5d8b9;
      --success-text: #2d4b38;
      --danger: #eebbbb;
      --danger-text: #5e3a3a;
    }

    body {
      font-family: "Noto Sans TC", system-ui, -apple-system, sans-serif;
      font-size: 15px;
      background-color: var(--bg);
      color: var(--text);
      margin: 0 auto;
      max-width: 800px; /* é€™è£¡è¨­å¯¬ä¸€é»å› ç‚ºæœ‰è¡¨æ ¼ */
      padding: 2rem 1rem;
      line-height: 1.6;
    }

    /* æ¨™é¡Œèˆ‡ Header */
    header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    h1 {
      margin: 0 0 0.5rem 0;
      color: #5e473a;
      font-weight: 800;
      font-size: 1.8rem;
    }
    
    .badge {
      display: inline-block;
      font-size: 0.85rem;
      color: var(--text-light);
      background: var(--secondary);
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: bold;
    }

    /* å°èˆªå€å¡Š */
    .nav-top {
      text-align: center;
      margin-bottom: 2rem;
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    .nav-btn {
      display: inline-flex;
      align-items: center;
      padding: 8px 14px;
      background-color: var(--secondary);
      color: #5e473a;
      border-radius: 10px;
      text-decoration: none;
      font-weight: bold;
      font-size: 0.95em;
      transition: all 0.3s ease;
    }
    
    .nav-btn:hover {
      background-color: var(--primary-hover);
      transform: translateY(-2px);
    }

    /* ä¸»å…§å®¹å€å¡Š */
    main {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: 1.5rem;
      padding: 2rem;
      box-shadow: 0 10px 30px rgba(216, 195, 165, 0.15);
    }

    /* å…§éƒ¨é ç±¤ (Tab) */
    .tab-nav {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      border-bottom: 2px solid var(--bg);
      padding-bottom: 1rem;
    }
    
    .tab-btn {
      flex: 1;
      background: transparent;
      border: 2px solid var(--border);
      color: var(--text-light);
      padding: 10px;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 1rem;
    }
    
    .tab-btn:hover {
      background: var(--bg);
    }
    
    .tab-btn.active {
      background: var(--secondary);
      border-color: var(--secondary);
      color: var(--text);
    }

    .panel { display: none; }
    .panel.active { display: block; animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(5px);} to{opacity:1;transform:translateY(0);} }

    /* è¡¨å–®å…ƒä»¶ */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.2rem;
      margin-bottom: 1.5rem;
    }

    label {
      display: block;
      margin-bottom: 0.4rem;
      font-weight: 700;
      color: var(--text-light);
      font-size: 0.95rem;
    }

    input, select, textarea {
      width: 100%;
      padding: 0.7rem;
      border-radius: 0.6rem;
      border: 2px solid #eee5dd;
      font-size: 1rem;
      background-color: #fdfdfd;
      transition: all 0.2s;
      box-sizing: border-box;
      color: var(--text);
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(216, 195, 165, 0.2);
      background-color: #fff;
    }

    /* è¡¨æ ¼æ¨£å¼ */
    .table-container {
      margin-top: 1rem;
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }
    
    th {
      text-align: left;
      padding: 0.5rem;
      color: var(--text-light);
      font-size: 0.9rem;
      border-bottom: 2px solid var(--border);
    }
    
    td {
      padding: 0.5rem 0;
    }

    /* æŒ‰éˆ•ç¾¤çµ„ */
    .btn-row {
      display: flex;
      gap: 0.8rem;
      margin-top: 1.5rem;
    }

    .btn {
      flex: 1;
      border: none;
      padding: 0.8rem 1rem;
      border-radius: 0.6rem;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn:hover { transform: translateY(-2px); opacity: 0.9; }
    .btn:active { transform: translateY(0); }

    .btn-primary { background-color: var(--primary); color: var(--text); }
    .btn-success { background-color: var(--success); color: var(--success-text); }
    .btn-danger { background-color: var(--danger); color: var(--danger-text); }
    .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-light); }

    .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.85rem; }

    /* è¼¸å‡ºå€å¡Š */
    .output-box {
      margin-top: 2rem;
      padding: 1.5rem;
      background: #faf7f5;
      border: 2px dashed var(--border);
      border-radius: 1rem;
      white-space: pre-wrap;
      color: #333;
      min-height: 100px;
    }

    /* Modal (åå†Š) */
    #rosterModal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.3);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(2px);
    }
    
    .modal-content {
      background: var(--white);
      width: 90%;
      max-width: 500px;
      padding: 2rem;
      border-radius: 1.5rem;
      box-shadow: 0 20px 60px rgba(0,0,0,0.1);
    }
    
    .modal-content h3 { margin-top: 0; color: var(--text); }

    /* Toast æç¤º */
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--primary);
      color: var(--text);
      padding: 10px 20px;
      border-radius: 50px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      z-index: 9999;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }
    .toast.show { opacity: 1; }

  </style>
</head>
<body>

<header>
  <h1>è½‰å…¥ï½œè¼¸å‡º å›å ±è¨Šæ¯</h1>
  <span class="badge">é†«å¸«èˆ‡å€‹æ¡ˆè¨Šæ¯æ¨¡æ¿</span>
</header>

<div class="nav-top">
  <a href="index.html" class="nav-btn">ğŸ”™ å›å ±èƒš</a>
  <a href="rescueICSI.html" class="nav-btn">ğŸ§¬ è£œæ•‘å—ç²¾</a>
  <a href="sperm.html" class="nav-btn">ğŸ§ª å‡ç²¾è¨Šæ¯</a>
</div>

<main>
  <div class="tab-nav">
    <button class="tab-btn active" onclick="switchTab('panel-doctor')">ğŸ‘¨â€âš•ï¸ é†«å¸«é€šçŸ¥</button>
    <button class="tab-btn" onclick="switchTab('panel-case')">ğŸ‘¤ å€‹æ¡ˆé€šçŸ¥</button>
  </div>

  <div id="panel-doctor" class="panel active">
    <div class="grid">
      <div>
        <label>ğŸ“„ æ¨¡æ¿é¡å‹</label>
        <select id="tplDoc" onchange="toggleDocFields()">
          <option value="doc_single">è½‰ç§»å®Œæˆé€šçŸ¥ï½œå–®ç­†</option>
          <option value="doc_group">åœ˜è½‰å…¥å®Œæˆé€šçŸ¥ï½œå¤šç­†</option>
        </select>
      </div>
      <div>
        <label>ğŸ“¦ è½‰å…¥ç¨®é¡</label>
        <select id="docType">
          <option value="èƒšèƒ">èƒšèƒ</option>
          <option value="åµå­">åµå­</option>
          <option value="å‡ç²¾">å‡ç²¾</option>
        </select>
      </div>
      <div>
        <label>ğŸ©º é†«å¸« <button onclick="openRoster()" class="btn btn-outline btn-sm" style="margin-left:5px">åå†Š</button></label>
        <input id="doctorName" placeholder="ä¾‹ï¼šé™³é†«å¸«" list="doctorList">
        <datalist id="doctorList"></datalist>
      </div>
    </div>

    <div id="single-fields" class="grid">
      <div>
        <label>ğŸ”¢ ç—…æ­·è™Ÿ</label>
        <input id="caseNo" placeholder="12345">
      </div>
      <div>
        <label>ğŸ‘¤ å§“å</label>
        <input id="caseName" placeholder="å®œéœ">
      </div>
    </div>

    <div id="group-fields" style="display:none;">
      <label>ğŸ“‹ å¤šç­†å€‹æ¡ˆåˆ—è¡¨</label>
      <div class="table-container">
        <table id="groupTable">
          <thead>
            <tr>
              <th width="35%">ç—…æ­·è™Ÿ</th>
              <th width="45%">å§“å</th>
              <th width="20%"></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="btn-row" style="margin-top:0.5rem; justify-content: flex-start;">
        <button class="btn btn-outline btn-sm" onclick="addRow()">+ æ–°å¢ä¸€åˆ—</button>
        <button class="btn btn-outline btn-sm" onclick="clearRows()" style="color:var(--danger-text)">æ¸…ç©ºè¡¨æ ¼</button>
      </div>
    </div>

    <div class="btn-row">
      <button class="btn btn-primary" onclick="genDoc()">âš™ï¸ ç”¢ç”Ÿè¨Šæ¯</button>
      <button class="btn btn-success" onclick="copyText('outDoc')">âœ… è¤‡è£½</button>
      <button class="btn btn-danger" onclick="clearDoc()">ğŸ—‘ï¸ æ¸…ç©º</button>
    </div>

    <div id="outDoc" class="output-box"></div>
  </div>

  <div id="panel-case" class="panel">
    <div class="grid">
      <div>
        <label>ğŸ“„ æ¨¡æ¿é¡å‹</label>
        <select id="tplCase">
          <option value="pt_import">é€šçŸ¥è½‰èƒšå®Œæˆ</option>
          <option value="pt_export">é€šçŸ¥è¼¸å‡ºå·²å®Œæˆæé ˜</option>
        </select>
      </div>
      <div>
        <label>ğŸ‘¤ åå­—</label>
        <input id="ptName" placeholder=" ">
      </div>
      <div>
        <label>ğŸ“¦ é¡å‹</label>
        <select id="ptType">
          <option value="åµå­">åµå­</option>
          <option value="èƒšèƒ">èƒšèƒ</option>
          <option value="å‡ç²¾">å‡ç²¾</option>
        </select>
      </div>
    </div>

    <div class="btn-row">
      <button class="btn btn-primary" onclick="genPt()">âš™ï¸ ç”¢ç”Ÿè¨Šæ¯</button>
      <button class="btn btn-success" onclick="copyText('outPt')">âœ… è¤‡è£½</button>
      <button class="btn btn-danger" onclick="clearPt()">ğŸ—‘ï¸ æ¸…ç©º</button>
    </div>

    <div id="outPt" class="output-box"></div>
  </div>

</main>

<div id="rosterModal">
  <div class="modal-content">
    <h3>ğŸ“ ç·¨è¼¯é†«å¸«åå†Š</h3>
    <p style="color:#666; font-size:0.9rem; margin-bottom:10px;">ä¸€è¡Œè¼¸å…¥ä¸€ä½é†«å¸«å§“åã€‚</p>
    <textarea id="rosterText" rows="8"></textarea>
    <div class="btn-row" style="margin-top:1.5rem">
      <button class="btn btn-primary" onclick="saveRoster()">å„²å­˜</button>
      <button class="btn btn-outline" onclick="closeRoster()">å–æ¶ˆ</button>
    </div>
  </div>
</div>

<div id="toast" class="toast">è¨Šæ¯å·²è¤‡è£½</div>

<script>
/* ===== å·¥å…· ===== */
const $ = id => document.getElementById(id);
const toastEl = $('toast');

function showToast(msg) {
  toastEl.textContent = msg;
  toastEl.classList.add('show');
  setTimeout(() => toastEl.classList.remove('show'), 1500);
}

function switchTab(targetId) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  
  $(targetId).classList.add('active');
  // æ‰¾å‡ºå°æ‡‰çš„æŒ‰éˆ•åŠ  active
  const btns = document.querySelectorAll('.tab-btn');
  if(targetId === 'panel-doctor') btns[0].classList.add('active');
  else btns[1].classList.add('active');
}

/* ===== é†«å¸«åå†Šé‚è¼¯ ===== */
const ROSTER_KEY = 'NUWA_DOCTOR_ROSTER';
const RECENT_KEY = 'NUWA_DOCTOR_RECENT';

function getList(key) {
  try { return JSON.parse(localStorage.getItem(key) || '[]'); } catch { return []; }
}

function initRoster() {
  if (!localStorage.getItem(ROSTER_KEY)) {
    const defaults = ["é™³é†«å¸«", "å»–é†«å¸«", "æ²ˆé†«å¸«", "è©¹é†«å¸«", "å¼µé†«å¸«", "ç‹é†«å¸«", "æ—é†«å¸«", "åŠ‰é†«å¸«", "æœ±é†«å¸«", "å³é†«å¸«", "ä½•é†«å¸«", "æ´ªé†«å¸«", "æé†«å¸«"];
    localStorage.setItem(ROSTER_KEY, JSON.stringify(defaults));
  }
  refreshDatalist();
}

function refreshDatalist() {
  const roster = getList(ROSTER_KEY);
  const recent = getList(RECENT_KEY);
  const unique = [...new Set([...recent, ...roster])]; // æœ€è¿‘ä½¿ç”¨çš„æ’å‰é¢
  
  const dl = $('doctorList');
  dl.innerHTML = '';
  unique.forEach(name => {
    const opt = document.createElement('option');
    opt.value = name;
    dl.appendChild(opt);
  });
}

function saveRecent(name) {
  if(!name) return;
  let list = getList(RECENT_KEY).filter(n => n !== name);
  list.unshift(name);
  if(list.length > 10) list = list.slice(0, 10);
  localStorage.setItem(RECENT_KEY, JSON.stringify(list));
  refreshDatalist();
}

/* Modal æ“ä½œ */
function openRoster() {
  $('rosterText').value = getList(ROSTER_KEY).join('\n');
  $('rosterModal').style.display = 'flex';
}
function closeRoster() { $('rosterModal').style.display = 'none'; }
function saveRoster() {
  const text = $('rosterText').value;
  const list = text.split('\n').map(s => s.trim()).filter(Boolean);
  localStorage.setItem(ROSTER_KEY, JSON.stringify([...new Set(list)]));
  refreshDatalist();
  closeRoster();
  showToast('åå†Šå·²æ›´æ–°');
}

/* ===== è¼¸å…¥è™•ç† (#å­—è™Ÿ) ===== */
function formatHash(input) {
  let v = input.value.trim();
  if(v && !v.startsWith('#')) input.value = '#' + v;
}

$('caseNo').addEventListener('blur', function() { formatHash(this); });

/* ===== é†«å¸«é€šçŸ¥é‚è¼¯ ===== */
const groupTbody = document.querySelector('#groupTable tbody');

function toggleDocFields() {
  const mode = $('tplDoc').value;
  if (mode === 'doc_single') {
    $('single-fields').style.display = 'grid';
    $('group-fields').style.display = 'none';
  } else {
    $('single-fields').style.display = 'none';
    $('group-fields').style.display = 'block';
    if(groupTbody.children.length === 0) { addRow(); addRow(); }
  }
}

function addRow() {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input class="no-input" placeholder="12345"></td>
    <td><input class="nm-input" placeholder="å§“å"></td>
    <td><button class="btn btn-outline btn-sm" onclick="this.closest('tr').remove()" style="border:none;color:#999">âŒ</button></td>
  `;
  groupTbody.appendChild(tr);
  // ç¶å®š # å­—è™Ÿäº‹ä»¶
  tr.querySelector('.no-input').addEventListener('blur', function() { formatHash(this); });
}

function clearRows() {
  groupTbody.innerHTML = '';
  addRow();
}

function genDoc() {
  const mode = $('tplDoc').value;
  const type = $('docType').value;
  const doctor = $('doctorName').value.trim() || 'é†«å¸«';
  
  if (doctor) saveRecent(doctor);

  let msg = '';
  if (mode === 'doc_single') {
    const no = $('caseNo').value.trim() || '#_____';
    const name = $('caseName').value.trim() || 'å§“å';
    msg = `${doctor}ï¼Œåˆå®‰\né€šçŸ¥æ‚¨ï¼Œ${no} ${name} çš„${type}å·²å®Œæˆè½‰å…¥å¯¦é©—å®¤ä½œæ¥­ï¼Œè¬è¬æ‚¨ã€‚`;
  } else {
    const rows = [...groupTbody.querySelectorAll('tr')];
    let list = [];
    rows.forEach(tr => {
      const no = tr.querySelector('.no-input').value.trim();
      const nm = tr.querySelector('.nm-input').value.trim();
      if(no || nm) list.push(`${no || '#_____'} ${nm}`);
    });
    
    if(list.length === 0) list = ['#12345 ç¯„ä¾‹å§“å'];
    
    msg = `${doctor}æ‚¨å¥½ï¼Œä»Šæ—¥å·²é †åˆ©å®Œæˆ${type}è½‰ç§»çš„å€‹æ¡ˆæœ‰ï¼š\n${list.join('\n')}\n\nè¬è¬æ‚¨ğŸ™`;
  }
  
  $('outDoc').textContent = msg;
}

function clearDoc() {
  $('doctorName').value = '';
  $('caseNo').value = '';
  $('caseName').value = '';
  clearRows();
  $('outDoc').textContent = '';
}

/* ===== å€‹æ¡ˆé€šçŸ¥é‚è¼¯ ===== */
function genPt() {
  const mode = $('tplCase').value;
  const name = $('ptName').value.trim() || 'åå­—';
  const type = $('ptType').value;
  
  let msg = '';
  if (mode === 'pt_import') {
    msg = `${name} æ‚¨å¥½ï¼Œ\næ‚¨çš„ ${type} å·²æ–¼ä»Šæ—¥é †åˆ©è½‰å…¥ ç¦¾é¦¨å®œè˜Šç”Ÿæ®–ä¸­å¿ƒï¼ˆå°åŒ—é™¢å€ï¼‰ã€‚\nç›¸é—œè©³ç´°è³‡è¨Šå¯é€é App æŸ¥è©¢ã€‚\næ­¤è¨Šæ¯ä»¥ LINE å‚³é€ï¼Œæ–¹ä¾¿æ‚¨å¾ŒçºŒç™‚ç¨‹çš„å®‰æ’ï¼Œè¬è¬æ‚¨ã€‚`;
  } else {
    msg = `${name} æ‚¨å¥½ï¼Œé€šçŸ¥æ‚¨çš„ ${type} å·²ç¶“å®Œæˆæé ˜é€²è¡Œé‹è¼¸ï¼Œè¬è¬æ‚¨ã€‚`;
  }
  
  $('outPt').textContent = msg;
}

function clearPt() {
  $('ptName').value = '';
  $('outPt').textContent = '';
}

/* ===== é€šç”¨åŠŸèƒ½ ===== */
function copyText(outputId) {
  const text = $(outputId).textContent;
  if (!text) { showToast('æ²’æœ‰å…§å®¹å¯è¤‡è£½'); return; }
  navigator.clipboard.writeText(text).then(() => showToast('å·²è¤‡è£½ï¼'));
}

// åˆå§‹åŒ–
initRoster();
toggleDocFields(); // é è¨­é¡¯ç¤ºå–®ç­†

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>凍精訊息產生器</title>
  <style>
    body {
      font-family: "Noto Sans TC", sans-serif;
      background-color: #fdfaf7;
      color: #4b3b30;
      max-width: 700px;
      margin: 0 auto;
      padding: 1.5rem;
      font-size: 16px; /* 全域字體大小 */
      line-height: 1.6;
    }
    h1 {
      text-align: center;
      margin-bottom: 1.2rem;
      font-size: 20px;
    }
    .nav {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    .nav a {
      display: inline-block;
      margin: 0 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      background: #d8c3a5;
      color: #fff;
      text-decoration: none;
      font-size: 14px;
      transition: background 0.2s;
    }
    .nav a:hover {
      background: #b89b7f;
    }
    label { display:block; margin-top:0.8rem; font-weight:bold; }
    input, select {
      width:100%; padding:0.5rem; margin-top:0.3rem;
      border-radius:0.4rem; border:1px solid #ccc;
      font-size:14px;
    }
    button {
      display:inline-block; margin:1rem 0.5rem 0 0;
      padding:0.6rem 1.2rem;
      border:none; border-radius:0.5rem;
      background:#d8c3a5; color:#fff; font-size:14px;
      cursor:pointer;
      transition: background 0.2s;
    }
    button:hover {
      background:#b89b7f;
    }
    #output {
      margin-top:1.5rem; padding:1rem;
      border:1px solid #ddd; border-radius:0.4rem;
      background:#fff;
      white-space:pre-line;
    }
    .scenario-block { display:none; margin-top:1rem; }
  </style>
</head>
<body>
  <h1>凍精訊息產生器</h1>

  <!-- 導航按鈕 -->
  <div class="nav">
    <a href="index.html">返回報胚訊息產生器</a>
    <a href="rescueICSI.html">補救受精回報訊息產生器</a>
  </div>

  <label for="scenario">選擇狀況：</label>
  <select id="scenario" onchange="switchScenario()">
    <option value="">--請選擇--</option>
    <option value="s1">個案不在現場等候</option>
    <option value="s2b">個案在現場，二取仍不佳</option>
  </select>

  <label>病歷號：<input type="text" id="caseId" placeholder="例：12345"></label>
  <label>姓名：<input type="text" id="caseName" placeholder="例：葉大雄"></label>

  <label for="doctor">選擇醫師：</label>
  <select id="doctor">
    <option value="">--請選擇--</option>
    <option value="陳醫師">陳醫師</option>
    <option value="廖院">廖院</option>
    <option value="詹醫師">詹醫師</option>
    <option value="沈醫師">沈醫師</option>
    <option value="張醫師">張醫師</option>
    <option value="劉醫師">劉醫師</option>
    <option value="朱院">朱院</option>
    <option value="王院">王院</option>
    <option value="林醫師">林醫師</option>
    <option value="李醫師">李醫師</option>
    <option value="何醫師">何醫師</option>
    <option value="洪醫師">洪醫師</option>
    <option value="自填">其他（自填）</option>
  </select>
  <input type="text" id="doctorCustom" placeholder="輸入醫師姓名" style="display:none;">

  <!-- 情境 1 -->
  <div id="scenario1" class="scenario-block">
    <h3>檢體數據</h3>
    <label>Volume (ml)：<input type="number" id="volume1" step="0.1"></label>
    <label>Concentration (M)：<input type="number" id="conc1"></label>
    <label>PR (%)：<input type="number" id="PR1"></label>
    <label>冷凍管數：<input type="number" id="tubes1"></label>

    <button onclick="generateDoctor1()">產生醫師訊息</button>
    <button onclick="generatePatient1()">產生個案訊息</button>
  </div>

  <!-- 情境 2B -->
  <div id="scenario2b" class="scenario-block">
    <h3>第一次檢體</h3>
    <label>Volume (ml)：<input type="number" id="volume21" step="0.1"></label>
    <label>Concentration (M)：<input type="number" id="conc21"></label>
    <label>PR (%)：<input type="number" id="PR21"></label>

    <h3>第二次檢體</h3>
    <label>Volume (ml)：<input type="number" id="volume22" step="0.1"></label>
    <label>Concentration (M)：<input type="number" id="conc22"></label>
    <label>PR (%)：<input type="number" id="PR22"></label>

    <label>冷凍管數：<input type="number" id="tubes2"></label>

    <button onclick="generateDoctor2B()">產生醫師訊息</button>
    <button onclick="generatePatient2B()">產生個案訊息</button>
  </div>

  <button onclick="copyMessage()">複製訊息</button>

  <div id="output"></div>

  <script>
    document.getElementById("doctor").addEventListener("change", function() {
      let custom = document.getElementById("doctorCustom");
      custom.style.display = (this.value === "自填") ? "block" : "none";
    });

    function switchScenario() {
      document.getElementById("scenario1").style.display = "none";
      document.getElementById("scenario2b").style.display = "none";
      let s = document.getElementById("scenario").value;
      if (s === "s1") document.getElementById("scenario1").style.display = "block";
      if (s === "s2b") document.getElementById("scenario2b").style.display = "block";
    }

    // === 情境 1 ===
    function generateDoctor1() {
      let caseId = document.getElementById("caseId").value.trim();
      let caseName = document.getElementById("caseName").value.trim();
      let doctor = document.getElementById("doctor").value;
      if (doctor === "自填") doctor = document.getElementById("doctorCustom").value;

      let volume = parseFloat(document.getElementById("volume1").value);
      let conc = parseFloat(document.getElementById("conc1").value);
      let PR = parseFloat(document.getElementById("PR1").value);
      let tubes = document.getElementById("tubes1").value.trim();

      let abnormalities = [];
      if (volume < 1) abnormalities.push(`Volume: ${volume} ml`);
      if (conc < 15) abnormalities.push(`Concentration: ${conc} M`);
      if (PR < 30) abnormalities.push(`PR: ${PR}%`);

      if (abnormalities.length === 0) {
        document.getElementById("output").innerText = "（數據無異常，不需傳訊息）";
        return;
      }

      let message = `${doctor}您好，\n
今日凍精個案 #${caseId} ${caseName}\n
檢體分析：\n
${abnormalities.join("\n")}\n
由於個案今日無法留在現場等候，實驗室已先將此次精蟲冷凍 ${tubes} 管，\n
建議個案可以擇日再凍精，或者於受精療程當天使用新鮮精蟲受精。\n`;

      document.getElementById("output").innerText = message;
    }

    function generatePatient1() {
      let caseName = document.getElementById("caseName").value.trim();
      let volume = parseFloat(document.getElementById("volume1").value);
      let conc = parseFloat(document.getElementById("conc1").value);
      let PR = parseFloat(document.getElementById("PR1").value);
      let tubes = document.getElementById("tubes1").value.trim();

      let abnormalities = [];
      if (volume < 1) abnormalities.push("體積不足");
      if (conc < 15) abnormalities.push("濃度偏低");
      if (PR < 30) abnormalities.push("活動力不足");

      if (abnormalities.length === 0) {
        document.getElementById("output").innerText = "（數據無異常，不需傳訊息）";
        return;
      }

      let message = `${caseName}您好，\n
今日檢體精蟲狀況較不理想（${abnormalities.join("、")}）。\n
我們已先將此次精蟲冷凍 ${tubes} 管，\n
建議您可擇日再次凍精，或於受精療程當天提供新鮮精液。\n
此次凍精的檢驗報告已上傳至 APP，您可隨時查詢；若有任何疑問，也建議您回診與醫師諮詢。\n
謝謝您。`;

      document.getElementById("output").innerText = message;
    }

    // === 情境 2B ===
    function generateDoctor2B() {
      let caseId = document.getElementById("caseId").value.trim();
      let caseName = document.getElementById("caseName").value.trim();
      let doctor = document.getElementById("doctor").value;
      if (doctor === "自填") doctor = document.getElementById("doctorCustom").value;

      let v1 = document.getElementById("volume21").value.trim();
      let c1 = document.getElementById("conc21").value.trim();
      let p1 = document.getElementById("PR21").value.trim();

      let v2 = document.getElementById("volume22").value.trim();
      let c2 = document.getElementById("conc22").value.trim();
      let p2 = document.getElementById("PR22").value.trim();

      let tubes = document.getElementById("tubes2").value.trim();

      let message = `${doctor}您好，\n
今日凍精個案 #${caseId} ${caseName}\n
檢體分析：\n
第一次：\n
  Volume: ${v1} ml\n
  Concentration: ${c1} M\n
  PR: ${p1}%\n
第二次：\n
  Volume: ${v2} ml\n
  Concentration: ${c2} M\n
  PR: ${p2}%\n
二次繳交後精蟲狀況仍不佳，\n
實驗室已先將此次精蟲冷凍 ${tubes} 管備用，\n
建議可請個案隔日再次凍精，或於受精療程當天使用新鮮精蟲。`;

      document.getElementById("output").innerText = message;
    }

    function generatePatient2B() {
      let caseName = document.getElementById("caseName").value.trim();
      let tubes = document.getElementById("tubes2").value.trim();

      let abn = [];
      let c2 = parseFloat(document.getElementById("conc22").value);
      let p2 = parseFloat(document.getElementById("PR22").value);

      if (c2 < 15) abn.push("濃度偏低");
      if (p2 < 30) abn.push("活動力不足");

      let abnText = abn.length > 0 ? `（${abn.join("、")}）` : "";

      let message = `${caseName}您好，\n
今日您於本院繳交 2 次檢體，精蟲狀況仍不理想${abnText}。\n
我們已先將此次精蟲冷凍 ${tubes} 管備用，\n
建議您可擇日再次凍精，或於受精療程當天提供新鮮精液。\n
此次檢驗報告已上傳至 APP，若有疑問也建議您回診與醫師諮詢。\n
謝謝您。`;

      document.getElementById("output").innerText = message;
    }

    // === 複製 ===
    function copyMessage() {
      let text = document.getElementById("output").innerText;
      if (!text || text.includes("不需傳訊息")) {
        alert("目前沒有需要複製的訊息");
        return;
      }
      navigator.clipboard.writeText(text).then(() => {
        alert("訊息已複製");
      });
    }
  </script>
</body>
</html>
